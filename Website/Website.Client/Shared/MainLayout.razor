@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<d-main>
    <d-nav>
        <d-panel>
            <VMContext VM="MainNav" TState="object">
                <d-nav-menu id="NavMenu" selected="@selectedRoute"></d-nav-menu>
            </VMContext>
        </d-panel>
    </d-nav>
    <d-header>
        <d-nav-drawer-button css="margin-left: 1rem"></d-nav-drawer-button>
        <d-panel css="margin-left: 1rem">
            <a href="@("/" + basePath)"><img width="200px" src="@dotNetifyIcon"></a>
        </d-panel>
    </d-header>
    <d-section>
        <d-frame>
            @Body
        </d-frame>
    </d-section>
</d-main>

@code {
   private readonly string dotNetifyIcon = Website.Client.Properties.Resources.DotNetifyIcon;
   private readonly string basePath = "blazor/";
   private string selectedRoute;

   protected override void OnInitialized()
   {
       this.selectedRoute = ToRouteId(NavigationManager.Uri);
       NavigationManager.LocationChanged += (sender, e) => { selectedRoute = ToRouteId(e.Location); StateHasChanged(); };
   }

   private string ToRouteId(string uri) => this.basePath + NavigationManager.ToBaseRelativePath(uri);
}